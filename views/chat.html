<script src="/socket.io-client/dist/socket.io.slim.js"></script>
<div class="chat-list-container">
    <div class="chat-list">


    </div>
    <button id="new-chat-btn"></button>
</div>
<div class="chat-container">
    <div class="chat-wrap">
        <div class="chat-box">
            <ul id="messages">

            </ul>
        </div>
        <div class="enter-box"> 
            <input type="text" id="content"> 
            <button id="sendBtn">전송</button>
        </div>
    </div>
</div>
<script type="text/javascript">
    
    const socket = io();
    let num = 0;
    var userInfo = JSON.parse(sessionStorage.getItem("user"));
    var userName = userInfo.user_name;
    var roomId = new Date().getTime()+"_"+fn_getRandomInt(1000,9999);

    socket.emit("access",{userInfo,roomId});
    socket.emit('joinRoom',userName,roomId);

    $('#sendBtn').click(() => {
      socket.emit('chatMessage',userName, $('#content').val());
      $('#content').val('');
      return false;
    });

    socket.on('chatMessage', ( name, msg, address) => {
      $('#messages').append($(`<li class="${userName == name ? "my-msg":"user-msg" }">`).text(name + '  :  ' +
        msg + `(${address})`));
    });

    socket.on('leaveRoom', (num, name) => {
        $('#messages').append($('<li>').text(`${name}님이 퇴장하셨습니다 (${address})`));
    });

    socket.on('joinRoom', (name, address) => {
      $('#messages').append($('<li>').text(`${name}님이 입장하셨습니다 (${address})`));
    });

    window.onbeforeunload = function() {
	    socket.emit('leaveRoom', userName);
    }

</script>