<script src="/socket.io-client/dist/socket.io.slim.js"></script>
<!-- <div class="chat-list-container">
    <div class="chat-list">


    </div>
    <button id="new-chat-btn"></button>
</div> -->
<div class="chat-container">
    <div class="chat-wrap">
        <div class="chat-box">
            <ul id="messages" class="message-list">

            </ul>
        </div>
        <div class="enter-box-area">
            <div class="enter-box">
                <input type="text" id="content">
                <button id="sendBtn" class="btn-send">보내기</button>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    
    const socket = io();
    let num = 0;
    var fieldName = JSON.parse(sessionStorage.getItem("user")).user_name;
    var roomCode = JSON.parse(sessionStorage.getItem("user")).user_id;

    socket.emit('joinRoom',fieldName); 

    $('#sendBtn').click(() => {
      socket.emit('chatMessage',fieldName, $('#content').val());
      $('#content').val('');
      return false;

        
    });

    socket.on('chatMessage', ( name, msg, address) => {
      $('#messages').append($(`<li class="${fieldName == name ? "my-msg":"user-msg" }">`).append(`<p class="msg-user">${name}</p><p class="msg-txt">${msg}</p>`));
        $(".my-msg .msg-user").hide();
        // .text(name + '  :  ' +
        // msg + `(${address})`));
    });

    socket.on('leaveRoom', (num, name) => {
        $('#messages').append($('<li class="room-info">').text(`${name}님이 퇴장하셨습니다 (${address})`));
    });

    socket.on('joinRoom', (name, address) => {
      $('#messages').append($('<li class="room-info">').text(`${name}님이 입장하셨습니다 (${address})`));
    });

    window.onbeforeunload = function() {
	    socket.emit('leaveRoom', fieldName);
    }

</script>